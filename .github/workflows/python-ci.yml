name: Python CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ['3.8', '3.9', '3.10', '3.11']

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
      continue-on-error: true
    
    - name: Check syntax with Python
      run: |
        python -m py_compile main.py app.py download_datasets.py
        find src -name "*.py" -type f -exec python -m py_compile {} \;
      continue-on-error: true
    
    - name: Lint with flake8 (optional)
      run: |
        pip install flake8
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics || true
        flake8 . --count --exit-zero --max-complexity=10 --max-line-length=127 --statistics || true
      continue-on-error: true
    
    - name: Verify project structure
      run: |
        echo "✓ Checking project structure..."
        [ -f main.py ] && echo "✓ main.py found" || echo "✗ main.py missing"
        [ -f app.py ] && echo "✓ app.py found" || echo "✗ app.py missing"
        [ -f requirements.txt ] && echo "✓ requirements.txt found" || echo "✗ requirements.txt missing"
        [ -d src ] && echo "✓ src/ directory found" || echo "✗ src/ missing"
        [ -d data ] && echo "✓ data/ directory found" || echo "✗ data/ missing"
        [ -f README.md ] && echo "✓ README.md found" || echo "✗ README.md missing"
        [ -f LICENSE ] && echo "✓ LICENSE found" || echo "✗ LICENSE missing"
      continue-on-error: true
